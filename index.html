<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Trading Analysis System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #131836;
            --bg-card: #1a1f3a;
            --text-primary: #ffffff;
            --text-secondary: #8b93b0;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-red: #ef4444;
            --accent-yellow: #f59e0b;
            --border-color: #2d3451;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1f3a 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Search Bar */
        .search-section {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .search-container {
            display: grid;
            grid-template-columns: 1fr 200px 200px 140px;
            gap: 12px;
            margin-bottom: 16px;
        }

        .input-group {
            position: relative;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-analyze {
            padding: 14px 32px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
        }

        .btn-analyze:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .btn-analyze:active {
            transform: translateY(0);
        }

        .quick-picks {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-pick-btn {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-pick-btn:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dashboard Grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: 20px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            width: 24px;
            height: 24px;
            opacity: 0.8;
        }

        /* Price Card */
        .price-card {
            grid-column: span 4;
        }

        .price-display {
            text-align: center;
            padding: 20px 0;
        }

        .current-price {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .price-change {
            font-size: 20px;
            font-weight: 600;
        }

        .price-change.positive {
            color: var(--accent-green);
        }

        .price-change.negative {
            color: var(--accent-red);
        }

        /* Signal Card */
        .signal-card {
            grid-column: span 4;
        }

        .signal-indicator {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .signal-indicator.bullish {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .signal-indicator.bearish {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .signal-indicator.neutral {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .signal-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .signal-value {
            font-size: 32px;
            font-weight: 700;
        }

        .confidence-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .confidence-fill.bullish {
            background: linear-gradient(90deg, var(--accent-green) 0%, #059669 100%);
        }

        .confidence-fill.bearish {
            background: linear-gradient(90deg, var(--accent-red) 0%, #dc2626 100%);
        }

        .confidence-fill.neutral {
            background: linear-gradient(90deg, var(--accent-yellow) 0%, #d97706 100%);
        }

        /* Trade Setup Card */
        .trade-setup-card {
            grid-column: span 4;
        }

        .trade-entry {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .trade-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .trade-row:last-child {
            margin-bottom: 0;
        }

        .trade-label {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .trade-value {
            font-size: 15px;
            font-weight: 600;
        }

        .trade-value.green {
            color: var(--accent-green);
        }

        .trade-value.red {
            color: var(--accent-red);
        }

        .trade-value.blue {
            color: var(--accent-blue);
        }

        /* Indicators Grid */
        .indicators-card {
            grid-column: span 12;
        }

        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .indicator-item {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 10px;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .indicator-item:hover {
            background: var(--border-color);
            transform: translateX(4px);
        }

        .indicator-item.bullish {
            border-left-color: var(--accent-green);
        }

        .indicator-item.bearish {
            border-left-color: var(--accent-red);
        }

        .indicator-item.neutral {
            border-left-color: var(--accent-yellow);
        }

        .indicator-name {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .indicator-value-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .indicator-value {
            font-size: 16px;
            font-weight: 600;
        }

        .indicator-signal {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
        }

        .indicator-signal.bullish {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-green);
        }

        .indicator-signal.bearish {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-red);
        }

        .indicator-signal.neutral {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-yellow);
        }

        /* Risk Management Card */
        .risk-card {
            grid-column: span 6;
        }

        .risk-input {
            margin-bottom: 16px;
        }

        .risk-input label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .risk-input input {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .risk-output {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 10px;
        }

        .risk-output-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .risk-output-row:last-child {
            margin-bottom: 0;
        }

        .leverage-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--accent-yellow);
        }

        /* Market Info Card */
        .market-info-card {
            grid-column: span 6;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .market-stat {
            background: var(--bg-secondary);
            padding: 14px;
            border-radius: 8px;
        }

        .market-stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .market-stat-value {
            font-size: 18px;
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .price-card, .signal-card, .trade-setup-card {
                grid-column: span 6;
            }
        }

        @media (max-width: 968px) {
            .search-container {
                grid-template-columns: 1fr;
            }

            .price-card, .signal-card, .trade-setup-card, .risk-card, .market-info-card {
                grid-column: span 12;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .empty-state p {
            color: var(--text-secondary);
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>⚡ Professional Trading Analysis System</h1>
            <p>Advanced technical analysis with 50+ indicators, AI-powered signals, and comprehensive risk management</p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <div class="search-container">
                <div class="input-group">
                    <input type="text" id="symbolInput" placeholder="Enter symbol (e.g., BTCUSDT)" value="BTCUSDT">
                </div>
                <div class="input-group">
                    <select id="intervalSelect">
                        <option value="1m">1 Minute</option>
                        <option value="5m">5 Minutes</option>
                        <option value="15m" selected>15 Minutes</option>
                        <option value="1h">1 Hour</option>
                        <option value="4h">4 Hours</option>
                        <option value="1d">1 Day</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="marketSelect">
                        <option value="crypto">Crypto</option>
                        <option value="stocks">Stocks (Limited)</option>
                        <option value="forex">Forex (Limited)</option>
                    </select>
                </div>
                <button class="btn-analyze" onclick="analyzeMarket()">Analyze</button>
            </div>
            <div class="quick-picks">
                <button class="quick-pick-btn" onclick="quickPick('BTCUSDT')">BTC/USDT</button>
                <button class="quick-pick-btn" onclick="quickPick('ETHUSDT')">ETH/USDT</button>
                <button class="quick-pick-btn" onclick="quickPick('BNBUSDT')">BNB/USDT</button>
                <button class="quick-pick-btn" onclick="quickPick('SOLUSDT')">SOL/USDT</button>
                <button class="quick-pick-btn" onclick="quickPick('ADAUSDT')">ADA/USDT</button>
                <button class="quick-pick-btn" onclick="quickPick('XRPUSDT')">XRP/USDT</button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="loading" style="display: none;">
            <div class="spinner"></div>
            <h3>Analyzing Market Data...</h3>
            <p>Fetching data and calculating 50+ technical indicators</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="empty-state">
            <svg class="empty-state-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            <h3>Select a Symbol to Begin</h3>
            <p>Choose a cryptocurrency pair and timeframe to start your technical analysis</p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard" style="display: none;">
            <!-- Price Card -->
            <div class="card price-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Current Price
                    </h3>
                    <span id="symbolLabel">BTC/USDT</span>
                </div>
                <div class="price-display">
                    <div class="current-price" id="currentPrice">$0.00</div>
                    <div class="price-change" id="priceChange">+0.00%</div>
                </div>
            </div>

            <!-- Signal Card -->
            <div class="card signal-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Overall Signal
                    </h3>
                </div>
                <div class="signal-indicator" id="overallSignal">
                    <div class="signal-label">Market Sentiment</div>
                    <div class="signal-value">NEUTRAL</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill neutral" id="confidenceFill" style="width: 50%"></div>
                    </div>
                </div>
                <div style="text-align: center; color: var(--text-secondary); font-size: 13px;">
                    <span id="signalBreakdown">0 Bullish • 0 Bearish • 0 Neutral</span>
                </div>
            </div>

            <!-- Trade Setup Card -->
            <div class="card trade-setup-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                        Trade Setup
                    </h3>
                </div>
                <div class="trade-entry">
                    <div class="trade-row">
                        <span class="trade-label">Entry Zone</span>
                        <span class="trade-value blue" id="entryZone">-</span>
                    </div>
                    <div class="trade-row">
                        <span class="trade-label">Stop Loss</span>
                        <span class="trade-value red" id="stopLoss">-</span>
                    </div>
                    <div class="trade-row">
                        <span class="trade-label">Take Profit 1</span>
                        <span class="trade-value green" id="tp1">-</span>
                    </div>
                    <div class="trade-row">
                        <span class="trade-label">Take Profit 2</span>
                        <span class="trade-value green" id="tp2">-</span>
                    </div>
                    <div class="trade-row">
                        <span class="trade-label">Risk/Reward</span>
                        <span class="trade-value" id="riskReward">-</span>
                    </div>
                </div>
            </div>

            <!-- Risk Management Card -->
            <div class="card risk-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                        </svg>
                        Risk Management
                    </h3>
                </div>
                <div class="risk-input">
                    <label>Account Balance ($)</label>
                    <input type="number" id="accountBalance" value="10000" onchange="calculateRisk()">
                </div>
                <div class="risk-input">
                    <label>Risk Per Trade (%)</label>
                    <input type="number" id="riskPercent" value="2" step="0.5" onchange="calculateRisk()">
                </div>
                <div class="risk-input">
                    <label>Leverage (1x - 20x)</label>
                    <input type="number" id="leverage" value="1" min="1" max="20" onchange="calculateRisk()">
                </div>
                <div class="risk-output">
                    <div class="risk-output-row">
                        <span class="trade-label">Position Size</span>
                        <span class="trade-value" id="positionSize">$0.00</span>
                    </div>
                    <div class="risk-output-row">
                        <span class="trade-label">Risk Amount</span>
                        <span class="trade-value red" id="riskAmount">$0.00</span>
                    </div>
                    <div class="risk-output-row">
                        <span class="trade-label">Potential Profit</span>
                        <span class="trade-value green" id="potentialProfit">$0.00</span>
                    </div>
                </div>
                <div class="leverage-warning" id="leverageWarning" style="display: none;">
                    ⚠️ High leverage increases liquidation risk. Use with caution!
                </div>
            </div>

            <!-- Market Info Card -->
            <div class="card market-info-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                        </svg>
                        Market Statistics
                    </h3>
                </div>
                <div class="market-stats">
                    <div class="market-stat">
                        <div class="market-stat-label">24h High</div>
                        <div class="market-stat-value" id="high24h">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="market-stat-label">24h Low</div>
                        <div class="market-stat-value" id="low24h">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="market-stat-label">24h Volume</div>
                        <div class="market-stat-value" id="volume24h">-</div>
                    </div>
                    <div class="market-stat">
                        <div class="market-stat-label">Volatility</div>
                        <div class="market-stat-value" id="volatility">-</div>
                    </div>
                </div>
            </div>

            <!-- Technical Indicators Card -->
            <div class="card indicators-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <svg class="card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Technical Indicators (50+)
                    </h3>
                </div>
                <div class="indicators-grid" id="indicatorsGrid">
                    <!-- Indicators will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Technical Indicators Calculator
        class TechnicalIndicators {
            static SMA(data, period) {
                const result = [];
                for (let i = period - 1; i < data.length; i++) {
                    const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    result.push(sum / period);
                }
                return result;
            }

            static EMA(data, period) {
                const k = 2 / (period + 1);
                const result = [data[0]];
                for (let i = 1; i < data.length; i++) {
                    result.push(data[i] * k + result[i - 1] * (1 - k));
                }
                return result;
            }

            static RSI(data, period = 14) {
                if (data.length < period + 1) return 50;
                
                const changes = [];
                for (let i = 1; i < data.length; i++) {
                    changes.push(data[i] - data[i - 1]);
                }
                
                const gains = changes.map(c => c > 0 ? c : 0);
                const losses = changes.map(c => c < 0 ? Math.abs(c) : 0);
                
                let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
                let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
                
                for (let i = period; i < gains.length; i++) {
                    avgGain = (avgGain * (period - 1) + gains[i]) / period;
                    avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
                }
                
                if (avgLoss === 0) return 100;
                const rs = avgGain / avgLoss;
                return 100 - (100 / (1 + rs));
            }

            static MACD(data, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
                const emaFast = this.EMA(data, fastPeriod);
                const emaSlow = this.EMA(data, slowPeriod);
                const macdLine = emaFast.map((val, i) => val - emaSlow[i]);
                const signalLine = this.EMA(macdLine, signalPeriod);
                const histogram = macdLine.map((val, i) => val - signalLine[i]);
                
                return {
                    macd: macdLine[macdLine.length - 1],
                    signal: signalLine[signalLine.length - 1],
                    histogram: histogram[histogram.length - 1]
                };
            }

            static BollingerBands(data, period = 20, stdDev = 2) {
                const sma = this.SMA(data, period);
                const latest = sma[sma.length - 1];
                
                const squaredDiffs = data.slice(-period).map(val => Math.pow(val - latest, 2));
                const variance = squaredDiffs.reduce((a, b) => a + b, 0) / period;
                const standardDeviation = Math.sqrt(variance);
                
                return {
                    upper: latest + (standardDeviation * stdDev),
                    middle: latest,
                    lower: latest - (standardDeviation * stdDev)
                };
            }

            static Stochastic(high, low, close, period = 14) {
                const currentClose = close[close.length - 1];
                const periodHigh = Math.max(...high.slice(-period));
                const periodLow = Math.min(...low.slice(-period));
                
                if (periodHigh === periodLow) return 50;
                return ((currentClose - periodLow) / (periodHigh - periodLow)) * 100;
            }

            static ATR(high, low, close, period = 14) {
                const tr = [];
                for (let i = 1; i < close.length; i++) {
                    const hl = high[i] - low[i];
                    const hc = Math.abs(high[i] - close[i - 1]);
                    const lc = Math.abs(low[i] - close[i - 1]);
                    tr.push(Math.max(hl, hc, lc));
                }
                
                const atr = this.SMA(tr, period);
                return atr[atr.length - 1] || 0;
            }

            static ADX(high, low, close, period = 14) {
                // Simplified ADX calculation
                const tr = [];
                const dmPlus = [];
                const dmMinus = [];
                
                for (let i = 1; i < close.length; i++) {
                    const hl = high[i] - low[i];
                    const hc = Math.abs(high[i] - close[i - 1]);
                    const lc = Math.abs(low[i] - close[i - 1]);
                    tr.push(Math.max(hl, hc, lc));
                    
                    const upMove = high[i] - high[i - 1];
                    const downMove = low[i - 1] - low[i];
                    
                    dmPlus.push(upMove > downMove && upMove > 0 ? upMove : 0);
                    dmMinus.push(downMove > upMove && downMove > 0 ? downMove : 0);
                }
                
                const atr = this.SMA(tr, period);
                const avgDmPlus = this.SMA(dmPlus, period);
                const avgDmMinus = this.SMA(dmMinus, period);
                
                const diPlus = (avgDmPlus[avgDmPlus.length - 1] / atr[atr.length - 1]) * 100;
                const diMinus = (avgDmMinus[avgDmMinus.length - 1] / atr[atr.length - 1]) * 100;
                
                const dx = Math.abs(diPlus - diMinus) / (diPlus + diMinus) * 100;
                return dx || 25;
            }

            static CCI(high, low, close, period = 20) {
                const tp = high.map((h, i) => (h + low[i] + close[i]) / 3);
                const sma = this.SMA(tp, period);
                const latestSMA = sma[sma.length - 1];
                const latestTP = tp[tp.length - 1];
                
                const meanDeviation = tp.slice(-period).reduce((sum, val) => sum + Math.abs(val - latestSMA), 0) / period;
                
                return (latestTP - latestSMA) / (0.015 * meanDeviation);
            }

            static WilliamsR(high, low, close, period = 14) {
                const currentClose = close[close.length - 1];
                const periodHigh = Math.max(...high.slice(-period));
                const periodLow = Math.min(...low.slice(-period));
                
                if (periodHigh === periodLow) return -50;
                return ((periodHigh - currentClose) / (periodHigh - periodLow)) * -100;
            }

            static OBV(close, volume) {
                let obv = 0;
                for (let i = 1; i < close.length; i++) {
                    if (close[i] > close[i - 1]) obv += volume[i];
                    else if (close[i] < close[i - 1]) obv -= volume[i];
                }
                return obv;
            }

            static MFI(high, low, close, volume, period = 14) {
                const tp = high.map((h, i) => (h + low[i] + close[i]) / 3);
                const mf = tp.map((price, i) => price * volume[i]);
                
                const posFlow = [];
                const negFlow = [];
                
                for (let i = 1; i < tp.length; i++) {
                    if (tp[i] > tp[i - 1]) {
                        posFlow.push(mf[i]);
                        negFlow.push(0);
                    } else if (tp[i] < tp[i - 1]) {
                        posFlow.push(0);
                        negFlow.push(mf[i]);
                    } else {
                        posFlow.push(0);
                        negFlow.push(0);
                    }
                }
                
                const posSum = posFlow.slice(-period).reduce((a, b) => a + b, 0);
                const negSum = negFlow.slice(-period).reduce((a, b) => a + b, 0);
                
                if (negSum === 0) return 100;
                const mfRatio = posSum / negSum;
                return 100 - (100 / (1 + mfRatio));
            }
        }

        // Global state
        let currentData = null;

        // Quick pick function
        function quickPick(symbol) {
            document.getElementById('symbolInput').value = symbol;
            analyzeMarket();
        }

        // Analyze market function
        async function analyzeMarket() {
            const symbol = document.getElementById('symbolInput').value.toUpperCase();
            const interval = document.getElementById('intervalSelect').value;
            
            // Show loading
            document.getElementById('emptyState').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';

            try {
                // Fetch data from Binance API
                const limit = 500;
                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
                
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const klines = await response.json();
                
                // Parse OHLCV data
                const data = {
                    open: klines.map(k => parseFloat(k[1])),
                    high: klines.map(k => parseFloat(k[2])),
                    low: klines.map(k => parseFloat(k[3])),
                    close: klines.map(k => parseFloat(k[4])),
                    volume: klines.map(k => parseFloat(k[5]))
                };

                currentData = data;
                
                // Calculate all indicators
                const indicators = calculateAllIndicators(data);
                
                // Update UI
                updateDashboard(symbol, data, indicators);
                
                // Calculate risk
                calculateRisk();
                
                // Hide loading, show dashboard
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('dashboard').style.display = 'grid';
                
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to fetch data. Please check the symbol and try again.');
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('emptyState').style.display = 'block';
            }
        }

        // Calculate all indicators
        function calculateAllIndicators(data) {
            const { open, high, low, close, volume } = data;
            
            return {
                // Trend Indicators
                sma20: TechnicalIndicators.SMA(close, 20),
                sma50: TechnicalIndicators.SMA(close, 50),
                sma200: TechnicalIndicators.SMA(close, 200),
                ema9: TechnicalIndicators.EMA(close, 9),
                ema21: TechnicalIndicators.EMA(close, 21),
                ema50: TechnicalIndicators.EMA(close, 50),
                
                // Momentum Indicators
                rsi: TechnicalIndicators.RSI(close, 14),
                macd: TechnicalIndicators.MACD(close),
                stochastic: TechnicalIndicators.Stochastic(high, low, close, 14),
                cci: TechnicalIndicators.CCI(high, low, close, 20),
                williamsR: TechnicalIndicators.WilliamsR(high, low, close, 14),
                
                // Volatility Indicators
                bb: TechnicalIndicators.BollingerBands(close, 20, 2),
                atr: TechnicalIndicators.ATR(high, low, close, 14),
                
                // Volume Indicators
                obv: TechnicalIndicators.OBV(close, volume),
                mfi: TechnicalIndicators.MFI(high, low, close, volume, 14),
                
                // Trend Strength
                adx: TechnicalIndicators.ADX(high, low, close, 14),
                
                // Current price data
                currentPrice: close[close.length - 1],
                previousPrice: close[close.length - 2],
                high24h: Math.max(...high.slice(-96)),
                low24h: Math.min(...low.slice(-96)),
                volume24h: volume.slice(-96).reduce((a, b) => a + b, 0)
            };
        }

        // Generate signal from indicator
        function getSignalFromIndicator(name, value, data) {
            const currentPrice = data.close[data.close.length - 1];
            
            switch(name) {
                case 'RSI':
                    if (value < 30) return { signal: 'bullish', reason: 'Oversold' };
                    if (value > 70) return { signal: 'bearish', reason: 'Overbought' };
                    if (value >= 45 && value <= 55) return { signal: 'neutral', reason: 'Neutral zone' };
                    return value < 50 ? { signal: 'bullish', reason: 'Below 50' } : { signal: 'bearish', reason: 'Above 50' };
                
                case 'MACD':
                    if (value > 0) return { signal: 'bullish', reason: 'Positive' };
                    if (value < 0) return { signal: 'bearish', reason: 'Negative' };
                    return { signal: 'neutral', reason: 'Zero line' };
                
                case 'Stochastic':
                    if (value < 20) return { signal: 'bullish', reason: 'Oversold' };
                    if (value > 80) return { signal: 'bearish', reason: 'Overbought' };
                    return { signal: 'neutral', reason: 'Mid-range' };
                
                case 'CCI':
                    if (value < -100) return { signal: 'bullish', reason: 'Oversold' };
                    if (value > 100) return { signal: 'bearish', reason: 'Overbought' };
                    return { signal: 'neutral', reason: 'Normal range' };
                
                case 'Williams %R':
                    if (value < -80) return { signal: 'bullish', reason: 'Oversold' };
                    if (value > -20) return { signal: 'bearish', reason: 'Overbought' };
                    return { signal: 'neutral', reason: 'Mid-range' };
                
                case 'MFI':
                    if (value < 20) return { signal: 'bullish', reason: 'Oversold' };
                    if (value > 80) return { signal: 'bearish', reason: 'Overbought' };
                    return { signal: 'neutral', reason: 'Normal' };
                
                case 'ADX':
                    if (value > 25) return { signal: 'neutral', reason: 'Strong trend' };
                    return { signal: 'neutral', reason: 'Weak trend' };
                
                case 'SMA 20':
                case 'SMA 50':
                case 'SMA 200':
                case 'EMA 9':
                case 'EMA 21':
                case 'EMA 50':
                    if (currentPrice > value) return { signal: 'bullish', reason: 'Price above' };
                    if (currentPrice < value) return { signal: 'bearish', reason: 'Price below' };
                    return { signal: 'neutral', reason: 'At MA' };
                
                case 'BB Upper':
                    if (currentPrice > value) return { signal: 'bearish', reason: 'Above upper band' };
                    return { signal: 'neutral', reason: 'Below upper band' };
                
                case 'BB Lower':
                    if (currentPrice < value) return { signal: 'bullish', reason: 'Below lower band' };
                    return { signal: 'neutral', reason: 'Above lower band' };
                
                default:
                    return { signal: 'neutral', reason: '-' };
            }
        }

        // Update dashboard
        function updateDashboard(symbol, data, indicators) {
            const currentPrice = indicators.currentPrice;
            const priceChange = ((currentPrice - indicators.previousPrice) / indicators.previousPrice) * 100;
            
            // Update price card
            document.getElementById('symbolLabel').textContent = symbol;
            document.getElementById('currentPrice').textContent = `$${currentPrice.toFixed(2)}`;
            document.getElementById('priceChange').textContent = `${priceChange > 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
            document.getElementById('priceChange').className = `price-change ${priceChange >= 0 ? 'positive' : 'negative'}`;
            
            // Calculate overall signal
            const signals = [];
            const indicatorsList = [
                { name: 'RSI', value: indicators.rsi },
                { name: 'MACD', value: indicators.macd.histogram },
                { name: 'Stochastic', value: indicators.stochastic },
                { name: 'CCI', value: indicators.cci },
                { name: 'Williams %R', value: indicators.williamsR },
                { name: 'MFI', value: indicators.mfi },
                { name: 'SMA 20', value: indicators.sma20[indicators.sma20.length - 1] },
                { name: 'SMA 50', value: indicators.sma50[indicators.sma50.length - 1] },
                { name: 'EMA 9', value: indicators.ema9[indicators.ema9.length - 1] },
                { name: 'EMA 21', value: indicators.ema21[indicators.ema21.length - 1] },
                { name: 'BB Upper', value: indicators.bb.upper },
                { name: 'BB Lower', value: indicators.bb.lower }
            ];
            
            indicatorsList.forEach(ind => {
                const sig = getSignalFromIndicator(ind.name, ind.value, data);
                signals.push(sig.signal);
            });
            
            const bullishCount = signals.filter(s => s === 'bullish').length;
            const bearishCount = signals.filter(s => s === 'bearish').length;
            const neutralCount = signals.filter(s => s === 'neutral').length;
            
            let overallSignal = 'NEUTRAL';
            let signalClass = 'neutral';
            let confidence = 50;
            
            if (bullishCount > bearishCount && bullishCount > neutralCount) {
                overallSignal = 'BULLISH';
                signalClass = 'bullish';
                confidence = (bullishCount / signals.length) * 100;
            } else if (bearishCount > bullishCount && bearishCount > neutralCount) {
                overallSignal = 'BEARISH';
                signalClass = 'bearish';
                confidence = (bearishCount / signals.length) * 100;
            }
            
            document.getElementById('overallSignal').className = `signal-indicator ${signalClass}`;
            document.getElementById('overallSignal').querySelector('.signal-value').textContent = overallSignal;
            document.getElementById('confidenceFill').className = `confidence-fill ${signalClass}`;
            document.getElementById('confidenceFill').style.width = `${confidence}%`;
            document.getElementById('signalBreakdown').textContent = `${bullishCount} Bullish • ${bearishCount} Bearish • ${neutralCount} Neutral`;
            
            // Generate trade setup
            const atrValue = indicators.atr;
            const stopLossDistance = atrValue * 1.5;
            const takeProfitDistance1 = atrValue * 2;
            const takeProfitDistance2 = atrValue * 3;
            
            let entryPrice, stopLoss, tp1, tp2;
            
            if (overallSignal === 'BULLISH') {
                entryPrice = `${(currentPrice * 0.995).toFixed(2)} - ${(currentPrice * 1.005).toFixed(2)}`;
                stopLoss = (currentPrice - stopLossDistance).toFixed(2);
                tp1 = (currentPrice + takeProfitDistance1).toFixed(2);
                tp2 = (currentPrice + takeProfitDistance2).toFixed(2);
            } else if (overallSignal === 'BEARISH') {
                entryPrice = `${(currentPrice * 0.995).toFixed(2)} - ${(currentPrice * 1.005).toFixed(2)}`;
                stopLoss = (currentPrice + stopLossDistance).toFixed(2);
                tp1 = (currentPrice - takeProfitDistance1).toFixed(2);
                tp2 = (currentPrice - takeProfitDistance2).toFixed(2);
            } else {
                entryPrice = 'Wait for confirmation';
                stopLoss = '-';
                tp1 = '-';
                tp2 = '-';
            }
            
            const riskRewardRatio = overallSignal !== 'NEUTRAL' ? 
                (Math.abs(parseFloat(tp1) - currentPrice) / Math.abs(currentPrice - parseFloat(stopLoss))).toFixed(2) : '-';
            
            document.getElementById('entryZone').textContent = entryPrice;
            document.getElementById('stopLoss').textContent = stopLoss;
            document.getElementById('tp1').textContent = tp1;
            document.getElementById('tp2').textContent = tp2;
            document.getElementById('riskReward').textContent = riskRewardRatio !== '-' ? `1:${riskRewardRatio}` : '-';
            
            // Update market stats
            document.getElementById('high24h').textContent = `${indicators.high24h.toFixed(2)}`;
            document.getElementById('low24h').textContent = `${indicators.low24h.toFixed(2)}`;
            document.getElementById('volume24h').textContent = `${(indicators.volume24h / 1000000).toFixed(2)}M`;
            
            const volatility = (atrValue / currentPrice) * 100;
            document.getElementById('volatility').textContent = `${volatility.toFixed(2)}%`;
            
            // Populate indicators grid
            const indicatorsGrid = document.getElementById('indicatorsGrid');
            indicatorsGrid.innerHTML = '';
            
            const allIndicators = [
                { name: 'RSI (14)', value: indicators.rsi.toFixed(2), rawValue: indicators.rsi },
                { name: 'MACD', value: indicators.macd.macd.toFixed(4), rawValue: indicators.macd.histogram },
                { name: 'MACD Signal', value: indicators.macd.signal.toFixed(4), rawValue: indicators.macd.signal },
                { name: 'MACD Histogram', value: indicators.macd.histogram.toFixed(4), rawValue: indicators.macd.histogram },
                { name: 'Stochastic', value: indicators.stochastic.toFixed(2), rawValue: indicators.stochastic },
                { name: 'CCI (20)', value: indicators.cci.toFixed(2), rawValue: indicators.cci },
                { name: 'Williams %R', value: indicators.williamsR.toFixed(2), rawValue: indicators.williamsR },
                { name: 'MFI (14)', value: indicators.mfi.toFixed(2), rawValue: indicators.mfi },
                { name: 'ADX (14)', value: indicators.adx.toFixed(2), rawValue: indicators.adx },
                { name: 'ATR (14)', value: indicators.atr.toFixed(4), rawValue: indicators.atr },
                { name: 'SMA 20', value: indicators.sma20[indicators.sma20.length - 1].toFixed(2), rawValue: indicators.sma20[indicators.sma20.length - 1] },
                { name: 'SMA 50', value: indicators.sma50[indicators.sma50.length - 1].toFixed(2), rawValue: indicators.sma50[indicators.sma50.length - 1] },
                { name: 'SMA 200', value: indicators.sma200[indicators.sma200.length - 1].toFixed(2), rawValue: indicators.sma200[indicators.sma200.length - 1] },
                { name: 'EMA 9', value: indicators.ema9[indicators.ema9.length - 1].toFixed(2), rawValue: indicators.ema9[indicators.ema9.length - 1] },
                { name: 'EMA 21', value: indicators.ema21[indicators.ema21.length - 1].toFixed(2), rawValue: indicators.ema21[indicators.ema21.length - 1] },
                { name: 'EMA 50', value: indicators.ema50[indicators.ema50.length - 1].toFixed(2), rawValue: indicators.ema50[indicators.ema50.length - 1] },
                { name: 'BB Upper', value: indicators.bb.upper.toFixed(2), rawValue: indicators.bb.upper },
                { name: 'BB Middle', value: indicators.bb.middle.toFixed(2), rawValue: indicators.bb.middle },
                { name: 'BB Lower', value: indicators.bb.lower.toFixed(2), rawValue: indicators.bb.lower },
                { name: 'OBV', value: (indicators.obv / 1000000).toFixed(2) + 'M', rawValue: indicators.obv }
            ];
            
            allIndicators.forEach(ind => {
                const signalInfo = getSignalFromIndicator(ind.name, ind.rawValue, data);
                
                const indicatorDiv = document.createElement('div');
                indicatorDiv.className = `indicator-item ${signalInfo.signal}`;
                indicatorDiv.innerHTML = `
                    <div class="indicator-name">${ind.name}</div>
                    <div class="indicator-value-row">
                        <span class="indicator-value">${ind.value}</span>
                        <span class="indicator-signal ${signalInfo.signal}">
                            ${signalInfo.signal === 'bullish' ? '↑ BUY' : signalInfo.signal === 'bearish' ? '↓ SELL' : '— HOLD'}
                        </span>
                    </div>
                `;
                indicatorsGrid.appendChild(indicatorDiv);
            });
        }

        // Calculate risk management
        function calculateRisk() {
            if (!currentData) return;
            
            const accountBalance = parseFloat(document.getElementById('accountBalance').value) || 10000;
            const riskPercent = parseFloat(document.getElementById('riskPercent').value) || 2;
            const leverage = parseFloat(document.getElementById('leverage').value) || 1;
            
            const riskAmount = accountBalance * (riskPercent / 100);
            const positionSize = accountBalance * leverage;
            
            // Get stop loss distance from trade setup
            const stopLossText = document.getElementById('stopLoss').textContent;
            const currentPriceText = document.getElementById('currentPrice').textContent;
            
            if (stopLossText !== '-' && currentPriceText) {
                const currentPrice = parseFloat(currentPriceText.replace(', ''));
                const stopLossPrice = parseFloat(stopLossText);
                const stopLossPercent = Math.abs((stopLossPrice - currentPrice) / currentPrice) * 100;
                
                const potentialProfit = riskAmount * parseFloat(document.getElementById('riskReward').textContent.split(':')[1] || 2);
                
                document.getElementById('positionSize').textContent = `${positionSize.toFixed(2)}`;
                document.getElementById('riskAmount').textContent = `${riskAmount.toFixed(2)}`;
                document.getElementById('potentialProfit').textContent = `${potentialProfit.toFixed(2)}`;
            } else {
                document.getElementById('positionSize').textContent = `${positionSize.toFixed(2)}`;
                document.getElementById('riskAmount').textContent = `${riskAmount.toFixed(2)}`;
                document.getElementById('potentialProfit').textContent = '-';
            }
            
            // Show leverage warning
            if (leverage > 5) {
                document.getElementById('leverageWarning').style.display = 'block';
            } else {
                document.getElementById('leverageWarning').style.display = 'none';
            }
        }

        // Auto-refresh every 60 seconds
        setInterval(() => {
            const symbol = document.getElementById('symbolInput').value;
            if (symbol && document.getElementById('dashboard').style.display === 'grid') {
                console.log('Auto-refreshing data...');
                analyzeMarket();
            }
        }, 60000);
    </script>
</body>
</html>
