<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ AI Trading Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .card-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #667eea;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .ai-response {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-size: 0.95em;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }

        .ai-response.loading {
            text-align: center;
            color: #667eea;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .trade-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .trade-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #ddd;
        }

        .trade-item.win {
            border-left-color: #28a745;
        }

        .trade-item.loss {
            border-left-color: #dc3545;
        }

        .trade-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .trade-symbol {
            font-weight: bold;
            font-size: 1.1em;
        }

        .trade-result {
            font-weight: bold;
            font-size: 1.2em;
        }

        .trade-result.win {
            color: #28a745;
        }

        .trade-result.loss {
            color: #dc3545;
        }

        .trade-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #856404;
        }

        .success-box {
            background: #d4edda;
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #155724;
        }

        .danger-box {
            background: #f8d7da;
            border: 2px solid #dc3545;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            color: #721c24;
        }

        .emotional-check {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .emotion-btn {
            padding: 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .emotion-btn:hover {
            background: #f0f0f0;
        }

        .emotion-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Trading Assistant</h1>
            <p>Your Personal Trading Co-Pilot | Discipline ‚Ä¢ Analysis ‚Ä¢ Growth</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('analysis')">üìä Market Analysis</button>
            <button class="tab" onclick="switchTab('trade')">üí∞ Trade Planning</button>
            <button class="tab" onclick="switchTab('journal')">üìì Trade Journal</button>
            <button class="tab" onclick="switchTab('performance')">üìà Performance</button>
        </div>

        <!-- MARKET ANALYSIS TAB -->
        <div id="analysis" class="tab-content active">
            <div class="main-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üîç</span>
                        <h2 class="card-title">Market Analysis</h2>
                    </div>
                    
                    <div class="input-group">
                        <label>Asset Symbol</label>
                        <input type="text" id="analysisSymbol" placeholder="e.g., BTC/USDT, AAPL, ETH/USD">
                    </div>

                    <div class="input-group">
                        <label>Current Situation</label>
                        <textarea id="analysisContext" placeholder="Describe what you're seeing... e.g., 'BTC broke $45k resistance with high volume, RSI at 65, forming bull flag on 1H chart'"></textarea>
                    </div>

                    <div class="input-group">
                        <label>What's Your Question?</label>
                        <select id="analysisQuestion">
                            <option value="should_trade">Should I take this trade?</option>
                            <option value="market_regime">What's the current market regime?</option>
                            <option value="risk_reward">What's the risk/reward here?</option>
                            <option value="exit_strategy">When should I exit?</option>
                            <option value="general">General analysis</option>
                        </select>
                    </div>

                    <button onclick="analyzeMarket()">üöÄ Get AI Analysis</button>

                    <div id="analysisResult"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üß†</span>
                        <h2 class="card-title">Emotional Check-In</h2>
                    </div>

                    <p style="margin-bottom: 15px; color: #666;">Before you trade, let's check your mental state:</p>

                    <div class="input-group">
                        <label>How are you feeling right now?</label>
                        <div class="emotional-check">
                            <div class="emotion-btn" onclick="selectEmotion(this, 'calm')">üòå Calm</div>
                            <div class="emotion-btn" onclick="selectEmotion(this, 'excited')">ü§© Excited</div>
                            <div class="emotion-btn" onclick="selectEmotion(this, 'anxious')">üò∞ Anxious</div>
                            <div class="emotion-btn" onclick="selectEmotion(this, 'frustrated')">üò§ Frustrated</div>
                            <div class="emotion-btn" onclick="selectEmotion(this, 'fomo')">üö® FOMO</div>
                            <div class="emotion-btn" onclick="selectEmotion(this, 'revenge')">üò° Revenge</div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Did you just have a losing trade?</label>
                        <select id="recentLoss">
                            <option value="no">No</option>
                            <option value="yes">Yes, just lost a trade</option>
                            <option value="streak">Yes, on a losing streak</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Why do you want to take this trade?</label>
                        <textarea id="tradeReason" placeholder="Be honest... Is this a solid setup or are you chasing?"></textarea>
                    </div>

                    <button onclick="emotionalCheck()">üßò Check My Mental State</button>

                    <div id="emotionalResult"></div>
                </div>
            </div>
        </div>

        <!-- TRADE PLANNING TAB -->
        <div id="trade" class="tab-content">
            <div class="main-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üíé</span>
                        <h2 class="card-title">Trade Setup</h2>
                    </div>

                    <div class="input-group">
                        <label>Asset</label>
                        <input type="text" id="tradeSymbol" placeholder="e.g., BTC/USDT">
                    </div>

                    <div class="input-group">
                        <label>Direction</label>
                        <select id="tradeDirection">
                            <option value="long">üìà Long (Buy)</option>
                            <option value="short">üìâ Short (Sell)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Entry Price</label>
                        <input type="number" id="entryPrice" step="0.01" placeholder="Planned entry">
                    </div>

                    <div class="input-group">
                        <label>Stop Loss</label>
                        <input type="number" id="stopLoss" step="0.01" placeholder="Where you'll cut losses">
                    </div>

                    <div class="input-group">
                        <label>Take Profit Target</label>
                        <input type="number" id="takeProfit" step="0.01" placeholder="Profit target">
                    </div>

                    <div class="input-group">
                        <label>Account Balance ($)</label>
                        <input type="number" id="accountBalance" value="10000" step="100">
                    </div>

                    <div class="input-group">
                        <label>Risk Per Trade (%)</label>
                        <input type="number" id="riskPercent" value="1" step="0.1" min="0.1" max="5">
                    </div>

                    <button onclick="calculateTrade()">üéØ Calculate Trade Plan</button>

                    <div id="tradeCalcResult"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">ü§ñ</span>
                        <h2 class="card-title">AI Trade Review</h2>
                    </div>

                    <p style="margin-bottom: 15px; color: #666;">Get AI feedback on your trade plan:</p>

                    <div class="input-group">
                        <label>Your Trade Setup</label>
                        <textarea id="tradeSetupDescription" placeholder="Describe your setup, timeframe, indicators, why you think this will work..."></textarea>
                    </div>

                    <button onclick="reviewTrade()">üîç Get AI Trade Review</button>

                    <div id="tradeReviewResult"></div>
                </div>
            </div>
        </div>

        <!-- TRADE JOURNAL TAB -->
        <div id="journal" class="tab-content">
            <div class="main-grid">
                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìù</span>
                        <h2 class="card-title">Log Trade</h2>
                    </div>

                    <div class="input-group">
                        <label>Asset</label>
                        <input type="text" id="journalSymbol" placeholder="e.g., BTC/USDT">
                    </div>

                    <div class="input-group">
                        <label>Direction</label>
                        <select id="journalDirection">
                            <option value="long">Long</option>
                            <option value="short">Short</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Entry Price</label>
                        <input type="number" id="journalEntry" step="0.01">
                    </div>

                    <div class="input-group">
                        <label>Exit Price</label>
                        <input type="number" id="journalExit" step="0.01">
                    </div>

                    <div class="input-group">
                        <label>Position Size ($)</label>
                        <input type="number" id="journalSize" step="1">
                    </div>

                    <div class="input-group">
                        <label>What Happened?</label>
                        <textarea id="journalNotes" placeholder="Why did you enter? What was your plan? Why did you exit? What did you learn?"></textarea>
                    </div>

                    <button onclick="logTrade()">üíæ Log Trade & Get AI Feedback</button>

                    <div id="journalFeedback"></div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-icon">üìö</span>
                        <h2 class="card-title">Trade History</h2>
                    </div>

                    <button onclick="analyzeTrades()" style="margin-bottom: 15px;">üß† AI Pattern Analysis</button>
                    <button onclick="clearTrades()" style="margin-bottom: 15px; background: #dc3545;">üóëÔ∏è Clear History</button>

                    <div id="tradeHistory" class="trade-list"></div>

                    <div id="patternAnalysis"></div>
                </div>
            </div>
        </div>

        <!-- PERFORMANCE TAB -->
        <div id="performance" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üìä</span>
                    <h2 class="card-title">Performance Dashboard</h2>
                </div>

                <div class="stats-grid" id="performanceStats"></div>

                <button onclick="getPerformanceFeedback()" style="margin-top: 20px;">üéØ Get AI Performance Review</button>

                <div id="performanceFeedback"></div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentEmotion = null;
        let trades = JSON.parse(localStorage.getItem('trades') || '[]');

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'performance') {
                updatePerformanceDashboard();
            } else if (tabName === 'journal') {
                displayTradeHistory();
            }
        }

        // Emotional check
        function selectEmotion(element, emotion) {
            document.querySelectorAll('.emotion-btn').forEach(btn => btn.classList.remove('selected'));
            element.classList.add('selected');
            currentEmotion = emotion;
        }

        // API call to Claude
        async function callClaudeAPI(prompt) {
            try {
                const response = await fetch("https://api.anthropic.com/v1/messages", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 2000,
                        messages: [
                            { role: "user", content: prompt }
                        ]
                    })
                });

                const data = await response.json();
                return data.content[0].text;
            } catch (error) {
                return "Error connecting to AI. Please check your connection and try again.";
            }
        }

        // Market Analysis
        async function analyzeMarket() {
            const symbol = document.getElementById('analysisSymbol').value;
            const context = document.getElementById('analysisContext').value;
            const question = document.getElementById('analysisQuestion').value;

            if (!symbol || !context) {
                alert('Please fill in asset symbol and current situation');
                return;
            }

            const resultDiv = document.getElementById('analysisResult');
            resultDiv.innerHTML = '<div class="ai-response loading">ü§ñ AI is analyzing the market...</div>';

            const questionMap = {
                'should_trade': 'Should I take this trade? Give me a clear YES or NO with reasoning.',
                'market_regime': 'What is the current market regime (trending/ranging/volatile)? How should I adjust my strategy?',
                'risk_reward': 'Analyze the risk/reward of this setup. Is it worth taking?',
                'exit_strategy': 'When should I exit this trade? Give me specific exit scenarios.',
                'general': 'Give me a comprehensive analysis of this market situation.'
            };

            const prompt = `You are an experienced trading mentor helping a trader analyze a market setup.

Asset: ${symbol}
Situation: ${context}
Question: ${questionMap[question]}

Provide:
1. Clear, direct answer to their question
2. Key observations about the setup
3. Risk factors to consider
4. Confidence level (1-10) with reasoning
5. What to watch for

Be honest, practical, and help them avoid emotional mistakes. If the setup is risky, say so clearly.`;

            const response = await callClaudeAPI(prompt);
            resultDiv.innerHTML = `<div class="ai-response">${response}</div>`;
        }

        // Emotional Check
        async function emotionalCheck() {
            if (!currentEmotion) {
                alert('Please select how you are feeling');
                return;
            }

            const recentLoss = document.getElementById('recentLoss').value;
            const reason = document.getElementById('tradeReason').value;

            if (!reason) {
                alert('Please explain why you want to take this trade');
                return;
            }

            const resultDiv = document.getElementById('emotionalResult');
            resultDiv.innerHTML = '<div class="ai-response loading">üßò AI is checking your mental state...</div>';

            const prompt = `You are a trading psychology coach. A trader wants to enter a trade, and you need to determine if they're in the right mental state.

Current Emotion: ${currentEmotion}
Recent Loss: ${recentLoss}
Their Reason for Trading: ${reason}

Analyze:
1. Are they trading emotionally or rationally?
2. Are there red flags (FOMO, revenge trading, overconfidence)?
3. Should they take this trade or wait?
4. Specific advice for their mental state

Be brutally honest. If they're clearly revenge trading or FOMOing, call it out directly and tell them to STOP.
Give them a clear GREEN LIGHT ‚úÖ or RED LIGHT üõë with reasoning.`;

            const response = await callClaudeAPI(prompt);
            
            const isGreenLight = response.toLowerCase().includes('green light') || response.toLowerCase().includes('‚úÖ');
            const boxClass = isGreenLight ? 'success-box' : 'danger-box';
            
            resultDiv.innerHTML = `<div class="${boxClass}">${response}</div>`;
        }

        // Calculate Trade
        function calculateTrade() {
            const entry = parseFloat(document.getElementById('entryPrice').value);
            const sl = parseFloat(document.getElementById('stopLoss').value);
            const tp = parseFloat(document.getElementById('takeProfit').value);
            const balance = parseFloat(document.getElementById('accountBalance').value);
            const riskPercent = parseFloat(document.getElementById('riskPercent').value);

            if (!entry || !sl || !tp || !balance || !riskPercent) {
                alert('Please fill in all fields');
                return;
            }

            const riskAmount = balance * (riskPercent / 100);
            const slDistance = Math.abs(entry - sl);
            const tpDistance = Math.abs(tp - entry);
            const riskReward = (tpDistance / slDistance).toFixed(2);
            const positionSize = (riskAmount / slDistance).toFixed(2);
            const potentialProfit = (positionSize * tpDistance).toFixed(2);
            const potentialLoss = riskAmount.toFixed(2);

            const resultDiv = document.getElementById('tradeCalcResult');
            
            let warningHTML = '';
            if (riskReward < 1.5) {
                warningHTML = '<div class="warning-box">‚ö†Ô∏è WARNING: Risk/Reward ratio is below 1.5. Consider finding a better setup!</div>';
            } else if (riskReward >= 2) {
                warningHTML = '<div class="success-box">‚úÖ Good Risk/Reward ratio! This is a quality setup.</div>';
            }

            resultDiv.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value">${riskReward}:1</div>
                        <div class="stat-label">Risk/Reward</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">$${positionSize}</div>
                        <div class="stat-label">Position Size</div>
                    </div>
                    <div class="stat-box" style="color: #28a745;">
                        <div class="stat-value">$${potentialProfit}</div>
                        <div class="stat-label">Potential Profit</div>
                    </div>
                    <div class="stat-box" style="color: #dc3545;">
                        <div class="stat-value">$${potentialLoss}</div>
                        <div class="stat-label">Max Loss (${riskPercent}%)</div>
                    </div>
                </div>
                ${warningHTML}
            `;
        }

        // Review Trade
        async function reviewTrade() {
            const symbol = document.getElementById('tradeSymbol').value;
            const direction = document.getElementById('tradeDirection').value;
            const entry = document.getElementById('entryPrice').value;
            const sl = document.getElementById('stopLoss').value;
            const tp = document.getElementById('takeProfit').value;
            const setup = document.getElementById('tradeSetupDescription').value;

            if (!symbol || !setup) {
                alert('Please fill in asset and setup description');
                return;
            }

            const resultDiv = document.getElementById('tradeReviewResult');
            resultDiv.innerHTML = '<div class="ai-response loading">ü§ñ AI is reviewing your trade...</div>';

            const prompt = `You are a professional trading mentor reviewing a trade setup.

Asset: ${symbol}
Direction: ${direction.toUpperCase()}
Entry: $${entry}
Stop Loss: $${sl}
Take Profit: $${tp}
Setup Description: ${setup}

Provide a critical review:
1. What's GOOD about this setup?
2. What are the RISKS?
3. Is the risk/reward acceptable?
4. What could go wrong?
5. What should they watch for during the trade?
6. Overall grade (A-F) and whether to take it

Be honest. If it's a bad trade, say so. Help them become a better trader.`;

            const response = await callClaudeAPI(prompt);
            resultDiv.innerHTML = `<div class="ai-response">${response}</div>`;
        }

        // Log Trade
        async function logTrade() {
            const symbol = document.getElementById('journalSymbol').value;
            const direction = document.getElementById('journalDirection').value;
            const entry = parseFloat(document.getElementById('journalEntry').value);
            const exit = parseFloat(document.getElementById('journalExit').value);
            const size = parseFloat(document.getElementById('journalSize').value);
            const notes = document.getElementById('journalNotes').value;

            if (!symbol || !entry || !exit || !size) {
                alert('Please fill in all trade details');
                return;
            }

            const pnl = direction === 'long' ? 
                ((exit - entry) / entry * 100 * size).toFixed(2) :
                ((entry - exit) / entry * 100 * size).toFixed(2);

            const trade = {
                id: Date.now(),
                date: new Date().toISOString(),
                symbol,
                direction,
                entry,
                exit,
                size,
                pnl: parseFloat(pnl),
                notes
            };

            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));

            // Get AI feedback
            const resultDiv = document.getElementById('journalFeedback');
            resultDiv.innerHTML = '<div class="ai-response loading">ü§ñ AI is analyzing your trade...</div>';

            const prompt = `You are a trading coach reviewing a completed trade.

Trade Details:
- Asset: ${symbol}
- Direction: ${direction}
- Entry: $${entry}
- Exit: $${exit}
- P&L: ${pnl > 0 ? '+' : ''}${pnl}%
- Trader's Notes: ${notes}

Provide feedback:
1. What did they do RIGHT? (even if they lost)
2. What could be IMPROVED?
3. What pattern/lesson to learn?
4. Encouragement or warning for next trade

Be constructive. Help them learn from wins AND losses.`;

            const response = await callClaudeAPI(prompt);
            
            const boxClass = pnl > 0 ? 'success-box' : 'danger-box';
            resultDiv.innerHTML = `<div class="${boxClass}">
                <strong>P&L: ${pnl > 0 ? '+' : ''}${pnl}%</strong>
            </div>
            <div class="ai-response">${response}</div>`;

            // Clear form and refresh history
            document.getElementById('journalSymbol').value = '';
            document.getElementById('journalEntry').value = '';
            document.getElementById('journalExit').value = '';
            document.getElementById('journalSize').value = '';
            document.getElementById('journalNotes').value = '';
            
            displayTradeHistory();
        }

        // Display Trade History
        function displayTradeHistory() {
            const historyDiv = document.getElementById('tradeHistory');
            
            if (trades.length === 0) {
                historyDiv.innerHTML = '<p style="text-align: center; color: #666;">No trades logged yet. Start tracking your trades!</p>';
                return;
            }

            const sortedTrades = [...trades].reverse();
            
            historyDiv.innerHTML = sortedTrades.map(trade => `
                <div class="trade-item ${trade.pnl > 0 ? 'win' : 'loss'}">
                    <div class="trade-header">
                        <span class="trade-symbol">${trade.symbol} (${trade.direction.toUpperCase()})</span>
                        <span class="trade-result ${trade.pnl > 0 ? 'win' : 'loss'}">${trade.pnl > 0 ? '+' : ''}${trade.pnl.toFixed(2)}%</span>
                    </div>
                    <div class="trade-details">
                        Entry: $${trade.entry} ‚Üí Exit: $${trade.exit} | Size: $${trade.size}
                    </div>
                    <div class="trade-details">
                        ${new Date(trade.date).toLocaleString()}
                    </div>
                    ${trade.notes ? `<div class="trade-details" style="margin-top: 8px; font-style: italic;">"${trade.notes}"</div>` : ''}
                </div>
            `).join('');
        }

        // Analyze Trades
        async function analyzeTrades() {
            if (trades.length < 3) {
                alert('Need at least 3 trades for pattern analysis');
                return;
            }

            const resultDiv = document.getElementById('patternAnalysis');
            resultDiv.innerHTML = '<div class="ai-response loading">üß† AI is analyzing your trading patterns...</div>';

            const tradesSummary = trades.map(t => 
                `${t.symbol} ${t.direction} | Entry: ${t.entry} Exit: ${t.exit} | P&L: ${t.pnl.toFixed(2)}% | Notes: ${t.notes}`
            ).join('\n');

            const prompt = `You are a trading psychology expert analyzing a trader's history. Here are their recent trades:

${tradesSummary}

Analyze and identify:
1. PATTERNS in their wins (what do they do right?)
2. PATTERNS in their losses (what mistakes repeat?)
3. EMOTIONAL TRADING signs (holding losers, cutting winners early, FOMO, revenge trading)
4. SPECIFIC ADVICE to improve their trading
5. Their biggest weakness and how to fix it

Be direct and honest. Help them see what they can't see themselves.`;

            const response = await callClaudeAPI(prompt);
            resultDiv.innerHTML = `<div class="ai-response">${response}</div>`;
        }

        // Update Performance Dashboard
        function updatePerformanceDashboard() {
            const statsDiv = document.getElementById('performanceStats');

            if (trades.length === 0) {
                statsDiv.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1/-1;">No trades yet. Start trading and track your progress!</p>';
                return;
            }

            const totalTrades = trades.length;
            const winners = trades.filter(t => t.pnl > 0).length;
            const losers = trades.filter(t => t.pnl < 0).length;
            const winRate = (winners / totalTrades * 100).toFixed(1);
            const totalPnL = trades.reduce((sum, t) => sum + t.pnl, 0).toFixed(2);
            const avgWin = winners > 0 ? (trades.filter(t => t.pnl > 0).reduce((sum, t) => sum + t.pnl, 0) / winners).toFixed(2) : 0;
            const avgLoss = losers > 0 ? (trades.filter(t => t.pnl < 0).reduce((sum, t) => sum + t.pnl, 0) / losers).toFixed(2) : 0;
            const profitFactor = losers > 0 ? Math.abs(avgWin / avgLoss).toFixed(2) : 'N/A';

            const winRateColor = winRate >= 50 ? '#28a745' : winRate >= 40 ? '#ffc107' : '#dc3545';
            const pnlColor = totalPnL > 0 ? '#28a745' : '#dc3545';

            statsDiv.innerHTML = `
                <div class="stat-box">
                    <div class="stat-value">${totalTrades}</div>
                    <div class="stat-label">Total Trades</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: ${winRateColor}">${winRate}%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: ${pnlColor}">${totalPnL > 0 ? '+' : ''}${totalPnL}%</div>
                    <div class="stat-label">Total P&L</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value">${profitFactor}</div>
                    <div class="stat-label">Profit Factor</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #28a745">+${avgWin}%</div>
                    <div class="stat-label">Avg Win</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #dc3545">${avgLoss}%</div>
                    <div class="stat-label">Avg Loss</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #28a745">${winners}</div>
                    <div class="stat-label">Winning Trades</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" style="color: #dc3545">${losers}</div>
                    <div class="stat-label">Losing Trades</div>
                </div>
            `;
        }

        // Get Performance Feedback
        async function getPerformanceFeedback() {
            if (trades.length < 5) {
                alert('Need at least 5 trades for meaningful performance analysis');
                return;
            }

            const resultDiv = document.getElementById('performanceFeedback');
            resultDiv.innerHTML = '<div class="ai-response loading">üéØ AI is analyzing your performance...</div>';

            const totalTrades = trades.length;
            const winners = trades.filter(t => t.pnl > 0).length;
            const winRate = (winners / totalTrades * 100).toFixed(1);
            const totalPnL = trades.reduce((sum, t) => sum + t.pnl, 0).toFixed(2);

            const prompt = `You are a professional trading coach reviewing a trader's overall performance.

Stats:
- Total Trades: ${totalTrades}
- Win Rate: ${winRate}%
- Total P&L: ${totalPnL}%
- Recent 5 Trades: ${trades.slice(-5).map(t => `${t.pnl > 0 ? 'WIN' : 'LOSS'} ${t.pnl.toFixed(1)}%`).join(', ')}

Provide:
1. Honest assessment of their performance
2. Are they improving or deteriorating?
3. Main weakness to work on
4. Specific action steps to improve
5. Motivational message (but honest)

Be direct. If they're struggling, tell them what needs to change. If they're doing well, tell them what to keep doing.`;

            const response = await callClaudeAPI(prompt);
            resultDiv.innerHTML = `<div class="ai-response">${response}</div>`;
        }

        // Clear Trades
        function clearTrades() {
            if (confirm('Are you sure you want to clear all trade history? This cannot be undone.')) {
                trades = [];
                localStorage.setItem('trades', JSON.stringify(trades));
                displayTradeHistory();
                updatePerformanceDashboard();
                alert('Trade history cleared');
            }
        }

        // Initialize
        displayTradeHistory();
        updatePerformanceDashboard();
    </script>
</body>
</html>
