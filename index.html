<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX Trading Terminal - Professional Grade</title>
    
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0a0d14;
            --bg-secondary: #0f1419;
            --bg-tertiary: #1a1f29;
            --bg-hover: #252b38;
            --border: rgba(148, 163, 184, 0.12);
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-dim: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --accent: #8b5cf6;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }
        
        .terminal-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 60px 1fr 200px;
            height: 100vh;
            gap: 1px;
            background: var(--border);
        }
        
        /* Header */
        .header {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .logo {
            font-size: 20px;
            font-weight: 900;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-right: 20px;
        }
        
        .mode-badge {
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
            animation: pulse 2s infinite;
        }
        
        .mode-paper {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
            border: 1px solid var(--warning);
        }
        
        .mode-live {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .search-container {
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            padding: 10px 16px 10px 40px;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-secondary);
        }
        
        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-dim);
            font-size: 16px;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }
        
        .search-results.active { display: block; }
        
        .search-result-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-result-item:hover { background: var(--bg-hover); }
        
        .search-result-item .symbol {
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .search-result-item .name {
            font-size: 12px;
            color: var(--text-secondary);
            margin-left: 8px;
        }
        
        .search-result-item .type {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }
        
        .type-crypto { background: rgba(139, 92, 246, 0.2); color: var(--accent); }
        .type-stock { background: rgba(59, 130, 246, 0.2); color: var(--info); }
        
        .header-stats {
            display: flex;
            gap: 20px;
            margin-left: auto;
        }
        
        .header-stat {
            text-align: right;
        }
        
        .header-stat-label {
            font-size: 10px;
            color: var(--text-dim);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .header-stat-value {
            font-size: 16px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Watchlist Sidebar */
        .watchlist {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .watchlist-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .watchlist-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .watchlist-items {
            flex: 1;
            overflow-y: auto;
        }
        
        .watchlist-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .watchlist-item:hover {
            background: var(--bg-hover);
        }
        
        .watchlist-item.active {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent);
        }
        
        .watchlist-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        
        .watchlist-symbol {
            font-size: 14px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .watchlist-price {
            font-size: 14px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .watchlist-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .watchlist-name {
            font-size: 11px;
            color: var(--text-dim);
        }
        
        .watchlist-change {
            font-size: 11px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Main Chart Area */
        .chart-area {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
        }
        
        .chart-controls {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .asset-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .asset-symbol {
            font-size: 20px;
            font-weight: 900;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .asset-price {
            font-size: 24px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .asset-change {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .change-positive {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }
        
        .change-negative {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .timeframe-selector {
            display: flex;
            gap: 4px;
            margin-left: auto;
            background: var(--bg-tertiary);
            padding: 4px;
            border-radius: 8px;
        }
        
        .tf-btn {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 700;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .tf-btn:hover { background: var(--bg-hover); color: var(--text-primary); }
        .tf-btn.active { background: var(--accent); color: white; }
        
        .chart-container {
            flex: 1;
            padding: 16px;
        }
        
        #chart { width: 100%; height: 100%; }
        
        /* Signals Panel */
        .signals-panel {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .signals-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .signals-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .signals-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .signal-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .signal-type {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .signal-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 800;
        }
        
        .signal-strong-buy {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }
        
        .signal-buy {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .signal-hold {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .signal-sell {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        .signal-strong-sell {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }
        
        .signal-details {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .signal-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .signal-metric {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
        }
        
        .signal-metric-label {
            color: var(--text-dim);
        }
        
        .signal-metric-value {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .confidence-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .confidence-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.3s;
        }
        
        .risk-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .risk-warning-title {
            font-size: 11px;
            font-weight: 800;
            color: var(--danger);
            margin-bottom: 6px;
        }
        
        .risk-warning-text {
            font-size: 10px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Bottom Panel - Portfolio/Positions */
        .bottom-panel {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }
        
        .panel-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
        }
        
        .panel-tab {
            padding: 12px 20px;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            border-bottom: 2px solid transparent;
        }
        
        .panel-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }
        
        .panel-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        
        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .positions-grid {
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        }
        
        .position-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
        }
        
        .position-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .position-symbol {
            font-size: 16px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .position-side {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
        }
        
        .side-long {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .side-short {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        .position-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 11px;
        }
        
        .position-metric {
            display: flex;
            justify-content: space-between;
        }
        
        .metric-label {
            color: var(--text-dim);
        }
        
        .metric-value {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .position-pnl {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pnl-label {
            font-size: 11px;
            color: var(--text-dim);
        }
        
        .pnl-value {
            font-size: 16px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Trade Journal */
        .journal-entry {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
        }
        
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .journal-time {
            font-size: 11px;
            color: var(--text-dim);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .journal-result {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
        }
        
        .result-win {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .result-loss {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }
        
        .journal-details {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .action-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn-buy {
            background: var(--success);
            color: white;
        }
        
        .btn-buy:hover {
            background: #059669;
            transform: translateY(-1px);
        }
        
        .btn-sell {
            background: var(--danger);
            color: white;
        }
        
        .btn-sell:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        
        .btn-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.3);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(139, 92, 246, 0.5);
        }
        
        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-dim);
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-dim);
            text-align: center;
        }
        
        .empty-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        .empty-text {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">‚ö° APEX</div>
            <div class="mode-badge mode-paper" id="modeBadge">üìù PAPER TRADING</div>
            
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput"
                    placeholder="Search symbols... (e.g., BTC, AAPL, ETH)"
                    autocomplete="off"
                />
                <div class="search-results" id="searchResults"></div>
            </div>
            
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-label">Portfolio</div>
                    <div class="header-stat-value" id="portfolioValue">$10,000.00</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-label">P&L Today</div>
                    <div class="header-stat-value positive" id="pnlToday">+$0.00</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-label">Win Rate</div>
                    <div class="header-stat-value" id="winRate">0%</div>
                </div>
            </div>
        </div>
        
        <!-- Watchlist Sidebar -->
        <div class="watchlist">
            <div class="watchlist-header">
                <span class="watchlist-title">Watchlist</span>
            </div>
            <div class="watchlist-items" id="watchlistItems">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading markets...</span>
                </div>
            </div>
        </div>
        
        <!-- Main Chart Area -->
        <div class="chart-area">
            <div class="chart-controls">
                <div class="asset-info">
                    <span class="asset-symbol" id="currentSymbol">---</span>
                    <span class="asset-price" id="currentPrice">$---</span>
                    <span class="asset-change change-positive" id="currentChange">+0.00%</span>
                </div>
                
                <div class="timeframe-selector">
                    <button class="tf-btn" data-tf="1m">1m</button>
                    <button class="tf-btn" data-tf="5m">5m</button>
                    <button class="tf-btn" data-tf="15m">15m</button>
                    <button class="tf-btn" data-tf="1h">1h</button>
                    <button class="tf-btn active" data-tf="4h">4h</button>
                    <button class="tf-btn" data-tf="1d">1d</button>
                </div>
            </div>
            
            <div class="chart-container">
                <div id="chart"></div>
            </div>
        </div>
        
        <!-- Signals Panel -->
        <div class="signals-panel">
            <div class="signals-header">
                <div class="signals-title">Analysis & Signals</div>
            </div>
            <div class="signals-content" id="signalsContent">
                <div class="empty-state">
                    <div class="empty-icon">üìä</div>
                    <div class="empty-text">Select an asset to view signals</div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Panel -->
        <div class="bottom-panel">
            <div class="panel-tabs">
                <div class="panel-tab active" data-tab="positions">Positions</div>
                <div class="panel-tab" data-tab="journal">Trade Journal</div>
                <div class="panel-tab" data-tab="alerts">Alerts</div>
            </div>
            <div class="panel-content" id="panelContent">
                <div class="empty-state">
                    <div class="empty-icon">üíº</div>
                    <div class="empty-text">No open positions</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // APEX TRADING TERMINAL - CORE ENGINE
        // ============================================================================
        
        console.log('%c‚ö° APEX TERMINAL INITIALIZED', 'color:#8b5cf6;font-size:20px;font-weight:bold;');
        console.log('%cProfessional-Grade Trading System', 'color:#3b82f6;font-size:12px;');
        
        // Global State
        const STATE = {
            mode: 'PAPER', // PAPER or LIVE
            portfolio: {
                cash: 10000,
                positions: [],
                trades: []
            },
            currentAsset: null,
            watchlist: [],
            chart: null,
            candleSeries: null,
            indicators: {},
            updateInterval: null,
            selectedTimeframe: '4h'
        };
        
        // ============================================================================
        // DATA PROVIDERS - Real API Endpoints
        // ============================================================================
        
        class DataProvider {
            // Crypto Data - Binance API (Free, No Auth Required)
            static async fetchCryptoData(symbol, interval = '4h', limit = 500) {
                try {
                    const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}USDT&interval=${interval}&limit=${limit}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.code) throw new Error(data.msg);
                    
                    return data.map(candle => ({
                        time: candle[0] / 1000,
                        open: parseFloat(candle[1]),
                        high: parseFloat(candle[2]),
                        low: parseFloat(candle[3]),
                        close: parseFloat(candle[4]),
                        volume: parseFloat(candle[5])
                    }));
                } catch (error) {
                    console.error('Crypto data error:', error);
                    return null;
                }
            }
            
            // Get Current Price
            static async getCurrentPrice(symbol, type = 'crypto') {
                if (type === 'crypto') {
                    try {
                        const url = `https://api.binance.com/api/v3/ticker/24hr?symbol=${symbol}USDT`;
                        const response = await fetch(url);
                        const data = await response.json();
                        
                        return {
                            price: parseFloat(data.lastPrice),
                            change24h: parseFloat(data.priceChangePercent),
                            volume24h: parseFloat(data.volume),
                            high24h: parseFloat(data.highPrice),
                            low24h: parseFloat(data.lowPrice)
                        };
                    } catch (error) {
                        console.error('Price fetch error:', error);
                        return null;
                    }
                }
            }
            
            // Get Top Crypto Markets
            static async getTopCryptoMarkets() {
                try {
                    const url = 'https://api.binance.com/api/v3/ticker/24hr';
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    // Filter USDT pairs and sort by volume
                    const markets = data
                        .filter(ticker => ticker.symbol.endsWith('USDT'))
                        .map(ticker => ({
                            symbol: ticker.symbol.replace('USDT', ''),
                            fullSymbol: ticker.symbol,
                            type: 'crypto',
                            price: parseFloat(ticker.lastPrice),
                            change24h: parseFloat(ticker.priceChangePercent),
                            volume24h: parseFloat(ticker.quoteVolume)
                        }))
                        .sort((a, b) => b.volume24h - a.volume24h)
                        .slice(0, 50); // Top 50 by volume
                    
                    return markets;
                } catch (error) {
                    console.error('Markets fetch error:', error);
                    return [];
                }
            }
            
            // Search Assets
            static async searchAssets(query) {
                query = query.toUpperCase();
                const markets = await this.getTopCryptoMarkets();
                
                return markets.filter(market => 
                    market.symbol.includes(query) || 
                    market.fullSymbol.includes(query)
                ).slice(0, 10);
            }
        }
        
        // ============================================================================
        // TECHNICAL ANALYSIS ENGINE
        // ============================================================================
        
        class TechnicalAnalysis {
            // Exponential Moving Average
            static EMA(data, period) {
                const k = 2 / (period + 1);
                const ema = [data[0]];
                for (let i = 1; i < data.length; i++) {
                    ema.push(data[i] * k + ema[i - 1] * (1 - k));
                }
                return ema;
            }
            
            // Relative Strength Index
            static RSI(data, period = 14) {
                const changes = [];
                for (let i = 1; i < data.length; i++) {
                    changes.push(data[i] - data[i - 1]);
                }
                
                const gains = changes.map(c => c > 0 ? c : 0);
                const losses = changes.map(c => c < 0 ? Math.abs(c) : 0);
                
                let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
                let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
                
                const rsi = [null];
                
                for (let i = period; i < changes.length; i++) {
                    avgGain = (avgGain * (period - 1) + gains[i]) / period;
                    avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
                    
                    const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
                    rsi.push(100 - (100 / (1 + rs)));
                }
                
                return rsi;
            }
            
            // MACD
            static MACD(data) {
                const ema12 = this.EMA(data, 12);
                const ema26 = this.EMA(data, 26);
                const macdLine = ema12.map((val, i) => val - ema26[i]);
                const signalLine = this.EMA(macdLine.filter(v => !isNaN(v)), 9);
                
                const histogram = [];
                const offset = macdLine.length - signalLine.length;
                for (let i = 0; i < macdLine.length; i++) {
                    if (i < offset) {
                        histogram.push(null);
                    } else {
                        histogram.push(macdLine[i] - signalLine[i - offset]);
                    }
                }
                
                return { macdLine, signalLine, histogram };
            }
            
            // ATR (Average True Range)
            static ATR(data, period = 14) {
                const tr = [];
                for (let i = 1; i < data.length; i++) {
                    const high = data[i].high;
                    const low = data[i].low;
                    const prevClose = data[i - 1].close;
                    
                    tr.push(Math.max(
                        high - low,
                        Math.abs(high - prevClose),
                        Math.abs(low - prevClose)
                    ));
                }
                
                return this.EMA(tr, period);
            }
            
            // Support and Resistance Levels
            static findSupportResistance(data, lookback = 50) {
                const recent = data.slice(-lookback);
                const highs = recent.map(d => d.high).sort((a, b) => b - a);
                const lows = recent.map(d => d.low).sort((a, b) => a - b);
                
                return {
                    resistance: highs[Math.floor(highs.length * 0.1)],
                    support: lows[Math.floor(lows.length * 0.1)]
                };
            }
            
            // Calculate All Indicators
            static calculateAll(data) {
                const closes = data.map(d => d.close);
                
                return {
                    ema9: this.EMA(closes, 9),
                    ema21: this.EMA(closes, 21),
                    ema50: this.EMA(closes, 50),
                    ema200: this.EMA(closes, 200),
                    rsi: this.RSI(closes, 14),
                    macd: this.MACD(closes),
                    atr: this.ATR(data, 14),
                    levels: this.findSupportResistance(data)
                };
            }
        }
        
        // ============================================================================
        // SIGNAL GENERATION ENGINE
        // ============================================================================
        
        class SignalEngine {
            static generateSignal(data, indicators) {
                const idx = data.length - 1;
                const price = data[idx].close;
                
                // Get indicator values
                const ema9 = indicators.ema9[idx];
                const ema21 = indicators.ema21[idx];
                const ema50 = indicators.ema50[idx];
                const ema200 = indicators.ema200[idx];
                const rsi = indicators.rsi[idx];
                const macdHist = indicators.macd.histogram[indicators.macd.histogram.length - 1];
                const atr = indicators.atr[indicators.atr.length - 1];
                
                let signal = 'HOLD';
                let confidence = 0;
                let reasons = [];
                
                // Trend Analysis
                const uptrend = ema9 > ema21 && ema21 > ema50;
                const downtrend = ema9 < ema21 && ema21 < ema50;
                const strongUptrend = uptrend && ema50 > ema200;
                const strongDowntrend = downtrend && ema50 < ema200;
                
                // BULLISH CONDITIONS
                if (strongUptrend && rsi < 70 && macdHist > 0) {
                    signal = 'STRONG_BUY';
                    confidence = 80;
                    reasons.push('Strong uptrend confirmed');
                    reasons.push('MACD histogram positive');
                    
                    if (rsi < 50) {
                        confidence += 10;
                        reasons.push('RSI shows room for growth');
                    }
                    
                    if (price > indicators.levels.resistance * 0.98) {
                        confidence += 5;
                        reasons.push('Breaking resistance');
                    }
                }
                else if (uptrend && rsi < 65) {
                    signal = 'BUY';
                    confidence = 65;
                    reasons.push('Uptrend in progress');
                    
                    if (macdHist > 0) {
                        confidence += 10;
                        reasons.push('MACD confirms momentum');
                    }
                }
                
                // BEARISH CONDITIONS
                else if (strongDowntrend && rsi > 30 && macdHist < 0) {
                    signal = 'STRONG_SELL';
                    confidence = 80;
                    reasons.push('Strong downtrend confirmed');
                    reasons.push('MACD histogram negative');
                    
                    if (rsi > 50) {
                        confidence += 10;
                        reasons.push('RSI shows weakness');
                    }
                }
                else if (downtrend && rsi > 35) {
                    signal = 'SELL';
                    confidence = 65;
                    reasons.push('Downtrend in progress');
                    
                    if (macdHist < 0) {
                        confidence += 10;
                        reasons.push('MACD confirms bearish momentum');
                    }
                }
                
                // NEUTRAL/RANGING
                else {
                    signal = 'HOLD';
                    confidence = 50;
                    reasons.push('No clear trend');
                    
                    if (rsi > 70) {
                        reasons.push('Overbought conditions');
                    } else if (rsi < 30) {
                        reasons.push('Oversold conditions');
                    }
                }
                
                // Risk Assessment
                const volatility = (atr / price) * 100;
                let riskLevel = 'MEDIUM';
                
                if (volatility > 5) {
                    riskLevel = 'HIGH';
                    confidence -= 10;
                } else if (volatility < 2) {
                    riskLevel = 'LOW';
                    confidence += 5;
                }
                
                return {
                    signal,
                    confidence: Math.max(0, Math.min(100, confidence)),
                    reasons,
                    riskLevel,
                    metrics: {
                        rsi: rsi?.toFixed(1) || 'N/A',
                        macdHist: macdHist?.toFixed(4) || 'N/A',
                        volatility: volatility?.toFixed(2) + '%' || 'N/A',
                        support: indicators.levels.support.toFixed(2),
                        resistance: indicators.levels.resistance.toFixed(2)
                    }
                };
            }
        }
        
        // ============================================================================
        // RISK MANAGEMENT SYSTEM
        // ============================================================================
        
        class RiskManager {
            static MAX_POSITION_SIZE = 0.2; // 20% of portfolio per trade
            static MAX_RISK_PER_TRADE = 0.02; // 2% risk per trade
            static STOP_LOSS_PERCENT = 0.03; // 3% stop loss
            static TAKE_PROFIT_MULTIPLIER = 2; // 2:1 risk/reward
            
            static calculatePositionSize(portfolio, entryPrice, stopLoss) {
                const riskAmount = portfolio.cash * this.MAX_RISK_PER_TRADE;
                const riskPerShare = Math.abs(entryPrice - stopLoss);
                const shares = riskAmount / riskPerShare;
                const positionValue = shares * entryPrice;
                
                // Cap at max position size
                const maxPositionValue = portfolio.cash * this.MAX_POSITION_SIZE;
                
                return Math.min(positionValue, maxPositionValue);
            }
            
            static calculateStopLoss(entryPrice, side) {
                if (side === 'LONG') {
                    return entryPrice * (1 - this.STOP_LOSS_PERCENT);
                } else {
                    return entryPrice * (1 + this.STOP_LOSS_PERCENT);
                }
            }
            
            static calculateTakeProfit(entryPrice, stopLoss, side) {
                const risk = Math.abs(entryPrice - stopLoss);
                const reward = risk * this.TAKE_PROFIT_MULTIPLIER;
                
                if (side === 'LONG') {
                    return entryPrice + reward;
                } else {
                    return entryPrice - reward;
                }
            }
            
            static validateTrade(portfolio, signal) {
                const warnings = [];
                
                // Check if we have enough cash
                if (portfolio.cash < 100) {
                    warnings.push('Insufficient cash for trading');
                    return { valid: false, warnings };
                }
                
                // Check if we're not too exposed
                const totalExposure = portfolio.positions.reduce((sum, pos) => sum + pos.size, 0);
                if (totalExposure > portfolio.cash * 0.8) {
                    warnings.push('Portfolio is highly exposed');
                }
                
                // Check signal confidence
                if (signal.confidence < 60) {
                    warnings.push('Low signal confidence');
                }
                
                // Check risk level
                if (signal.riskLevel === 'HIGH') {
                    warnings.push('High volatility detected');
                }
                
                return {
                    valid: warnings.length === 0 || warnings[0] !== 'Insufficient cash for trading',
                    warnings
                };
            }
        }
        
        // ============================================================================
        // CHART INITIALIZATION
        // ============================================================================
        
        function initChart() {
            const container = document.getElementById('chart');
            
            STATE.chart = LightweightCharts.createChart(container, {
                layout: {
                    background: { color: 'transparent' },
                    textColor: '#94a3b8'
                },
                grid: {
                    vertLines: { color: 'rgba(148, 163, 184, 0.05)' },
                    horzLines: { color: 'rgba(148, 163, 184, 0.05)' }
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal
                },
                rightPriceScale: {
                    borderColor: 'rgba(148, 163, 184, 0.12)'
                },
                timeScale: {
                    borderColor: 'rgba(148, 163, 184, 0.12)',
                    timeVisible: true,
                    secondsVisible: false
                },
                handleScale: {
                    axisPressedMouseMove: {
                        time: true,
                        price: true
                    }
                }
            });
            
            STATE.candleSeries = STATE.chart.addCandlestickSeries({
                upColor: '#10b981',
                downColor: '#ef4444',
                borderVisible: false,
                wickUpColor: '#10b981',
                wickDownColor: '#ef4444'
            });
            
            // Auto-resize chart
            new ResizeObserver(() => {
                STATE.chart.applyOptions({
                    width: container.clientWidth,
                    height: container.clientHeight
                });
            }).observe(container);
        }
        
        // ============================================================================
        // UI UPDATE FUNCTIONS
        // ============================================================================
        
        async function loadWatchlist() {
            const container = document.getElementById('watchlistItems');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><span>Loading markets...</span></div>';
            
            const markets = await DataProvider.getTopCryptoMarkets();
            
            // Select top assets
            const topAssets = [
                'BTC', 'ETH', 'BNB', 'SOL', 'XRP', 'ADA', 'DOGE', 'AVAX', 
                'DOT', 'MATIC', 'LINK', 'UNI', 'ATOM', 'LTC', 'NEAR'
            ];
            
            STATE.watchlist = markets.filter(m => topAssets.includes(m.symbol));
            
            container.innerHTML = '';
            
            STATE.watchlist.forEach((asset, index) => {
                const item = document.createElement('div');
                item.className = 'watchlist-item';
                if (index === 0) item.classList.add('active');
                
                const changeClass = asset.change24h >= 0 ? 'positive' : 'negative';
                const changeSign = asset.change24h >= 0 ? '+' : '';
                
                item.innerHTML = `
                    <div class="watchlist-item-header">
                        <span class="watchlist-symbol">${asset.symbol}</span>
                        <span class="watchlist-price ${changeClass}">$${asset.price.toFixed(asset.price > 100 ? 2 : 4)}</span>
                    </div>
                    <div class="watchlist-item-footer">
                        <span class="watchlist-name">${asset.type.toUpperCase()}</span>
                        <span class="watchlist-change ${changeClass}">${changeSign}${asset.change24h.toFixed(2)}%</span>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    document.querySelectorAll('.watchlist-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    loadAsset(asset);
                });
                
                container.appendChild(item);
            });
            
            // Load first asset
            if (STATE.watchlist.length > 0) {
                loadAsset(STATE.watchlist[0]);
            }
        }
        
        async function loadAsset(asset) {
            STATE.currentAsset = asset;
            
            // Update header
            document.getElementById('currentSymbol').textContent = asset.symbol;
            document.getElementById('currentPrice').textContent = `$${asset.price.toFixed(asset.price > 100 ? 2 : 6)}`;
            
            const changeElement = document.getElementById('currentChange');
            changeElement.textContent = `${asset.change24h >= 0 ? '+' : ''}${asset.change24h.toFixed(2)}%`;
            changeElement.className = `asset-change ${asset.change24h >= 0 ? 'change-positive' : 'change-negative'}`;
            
            // Load chart data
            const data = await DataProvider.fetchCryptoData(asset.symbol, STATE.selectedTimeframe);
            
            if (data) {
                STATE.candleSeries.setData(data);
                
                // Calculate indicators
                STATE.indicators = TechnicalAnalysis.calculateAll(data);
                
                // Generate signal
                const signal = SignalEngine.generateSignal(data, STATE.indicators);
                
                // Update signals panel
                updateSignalsPanel(signal);
            }
        }
        
        function updateSignalsPanel(signal) {
            const container = document.getElementById('signalsContent');
            
            const signalClasses = {
                'STRONG_BUY': 'signal-strong-buy',
                'BUY': 'signal-buy',
                'HOLD': 'signal-hold',
                'SELL': 'signal-sell',
                'STRONG_SELL': 'signal-strong-sell'
            };
            
            const signalLabels = {
                'STRONG_BUY': 'üöÄ STRONG BUY',
                'BUY': 'üìà BUY',
                'HOLD': '‚è∏Ô∏è HOLD',
                'SELL': 'üìâ SELL',
                'STRONG_SELL': '‚ö†Ô∏è STRONG SELL'
            };
            
            container.innerHTML = `
                <div class="signal-card">
                    <div class="signal-header">
                        <span class="signal-type">Technical Signal</span>
                        <span class="signal-badge ${signalClasses[signal.signal]}">${signalLabels[signal.signal]}</span>
                    </div>
                    
                    <div class="signal-details">
                        ${signal.reasons.map(r => `‚Ä¢ ${r}`).join('<br>')}
                    </div>
                    
                    <div class="signal-metrics">
                        <div class="signal-metric">
                            <span class="signal-metric-label">RSI</span>
                            <span class="signal-metric-value">${signal.metrics.rsi}</span>
                        </div>
                        <div class="signal-metric">
                            <span class="signal-metric-label">Risk</span>
                            <span class="signal-metric-value">${signal.riskLevel}</span>
                        </div>
                        <div class="signal-metric">
                            <span class="signal-metric-label">Support</span>
                            <span class="signal-metric-value">$${signal.metrics.support}</span>
                        </div>
                        <div class="signal-metric">
                            <span class="signal-metric-label">Resistance</span>
                            <span class="signal-metric-value">$${signal.metrics.resistance}</span>
                        </div>
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill" style="width: ${signal.confidence}%"></div>
                    </div>
                    <div style="margin-top: 6px; font-size: 11px; color: var(--text-dim);">
                        Confidence: ${signal.confidence}%
                    </div>
                </div>
                
                <div class="risk-warning">
                    <div class="risk-warning-title">‚ö†Ô∏è RISK DISCLAIMER</div>
                    <div class="risk-warning-text">
                        This is an automated signal based on technical analysis. 
                        Past performance does not guarantee future results. 
                        Always conduct your own research and never risk more than you can afford to lose.
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn btn-buy" onclick="simulateTrade('LONG')">
                        BUY (PAPER)
                    </button>
                    <button class="action-btn btn-sell" onclick="simulateTrade('SHORT')">
                        SELL (PAPER)
                    </button>
                </div>
            `;
        }
        
        // ============================================================================
        // SEARCH FUNCTIONALITY
        // ============================================================================
        
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        
        let searchTimeout;
        
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            if (query.length < 2) {
                searchResults.classList.remove('active');
                return;
            }
            
            searchTimeout = setTimeout(async () => {
                const results = await DataProvider.searchAssets(query);
                displaySearchResults(results);
            }, 300);
        });
        
        function displaySearchResults(results) {
            if (results.length === 0) {
                searchResults.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-dim);">No results found</div>';
                searchResults.classList.add('active');
                return;
            }
            
            searchResults.innerHTML = results.map(result => `
                <div class="search-result-item" onclick="selectSearchResult('${result.symbol}', '${result.type}')">
                    <div>
                        <span class="symbol">${result.symbol}</span>
                        <span class="name">${result.fullSymbol}</span>
                    </div>
                    <span class="type type-${result.type}">${result.type.toUpperCase()}</span>
                </div>
            `).join('');
            
            searchResults.classList.add('active');
        }
        
        window.selectSearchResult = async function(symbol, type) {
            searchResults.classList.remove('active');
            searchInput.value = '';
            
            const asset = STATE.watchlist.find(a => a.symbol === symbol);
            if (asset) {
                loadAsset(asset);
                
                // Update active state in watchlist
                document.querySelectorAll('.watchlist-item').forEach((item, index) => {
                    item.classList.remove('active');
                    if (STATE.watchlist[index].symbol === symbol) {
                        item.classList.add('active');
                    }
                });
            } else {
                // Load from API if not in watchlist
                const priceData = await DataProvider.getCurrentPrice(symbol, type);
                if (priceData) {
                    const newAsset = {
                        symbol,
                        type,
                        price: priceData.price,
                        change24h: priceData.change24h
                    };
                    loadAsset(newAsset);
                }
            }
        };
        
        // Close search results when clicking outside
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.remove('active');
            }
        });
        
        // ============================================================================
        // TRADING SIMULATION (PAPER TRADING)
        // ============================================================================
        
        window.simulateTrade = function(side) {
            if (!STATE.currentAsset) return;
            
            const entryPrice = STATE.currentAsset.price;
            const stopLoss = RiskManager.calculateStopLoss(entryPrice, side);
            const takeProfit = RiskManager.calculateTakeProfit(entryPrice, stopLoss, side);
            const positionSize = RiskManager.calculatePositionSize(STATE.portfolio, entryPrice, stopLoss);
            
            // Validate trade
            const data = STATE.candleSeries.data();
            const signal = SignalEngine.generateSignal(data, STATE.indicators);
            const validation = RiskManager.validateTrade(STATE.portfolio, signal);
            
            if (!validation.valid) {
                alert(validation.warnings.join('\n'));
                return;
            }
            
            // Create position
            const position = {
                id: Date.now(),
                symbol: STATE.currentAsset.symbol,
                side,
                entryPrice,
                entryTime: Date.now(),
                size: positionSize,
                stopLoss,
                takeProfit,
                currentPrice: entryPrice,
                pnl: 0,
                pnlPercent: 0
            };
            
            STATE.portfolio.positions.push(position);
            STATE.portfolio.cash -= positionSize;
            
            // Update UI
            updatePortfolioDisplay();
            updatePositionsPanel();
            
            // Log trade
            console.log(`üìù PAPER TRADE EXECUTED:`, position);
            alert(`‚úÖ Paper trade placed!\n\n${side} ${STATE.currentAsset.symbol}\nEntry: $${entryPrice.toFixed(2)}\nSize: $${positionSize.toFixed(2)}\nStop Loss: $${stopLoss.toFixed(2)}\nTake Profit: $${takeProfit.toFixed(2)}`);
        };
        
        function updatePortfolioDisplay() {
            const totalValue = STATE.portfolio.cash + 
                STATE.portfolio.positions.reduce((sum, pos) => sum + pos.size, 0);
            
            document.getElementById('portfolioValue').textContent = 
                `$${totalValue.toFixed(2)}`;
            
            // Calculate P&L
            const pnl = totalValue - 10000;
            const pnlElement = document.getElementById('pnlToday');
            pnlElement.textContent = `${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}`;
            pnlElement.className = `header-stat-value ${pnl >= 0 ? 'positive' : 'negative'}`;
            
            // Calculate win rate
            const closedTrades = STATE.portfolio.trades;
            const winningTrades = closedTrades.filter(t => t.pnl > 0).length;
            const winRate = closedTrades.length > 0 
                ? (winningTrades / closedTrades.length * 100).toFixed(0) 
                : 0;
            
            document.getElementById('winRate').textContent = `${winRate}%`;
        }
        
        function updatePositionsPanel() {
            const container = document.getElementById('panelContent');
            
            if (STATE.portfolio.positions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üíº</div>
                        <div class="empty-text">No open positions</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="positions-grid">
                    ${STATE.portfolio.positions.map(pos => `
                        <div class="position-card">
                            <div class="position-header">
                                <span class="position-symbol">${pos.symbol}</span>
                                <span class="position-side side-${pos.side.toLowerCase()}">${pos.side}</span>
                            </div>
                            <div class="position-metrics">
                                <div class="position-metric">
                                    <span class="metric-label">Entry</span>
                                    <span class="metric-value">$${pos.entryPrice.toFixed(2)}</span>
                                </div>
                                <div class="position-metric">
                                    <span class="metric-label">Size</span>
                                    <span class="metric-value">$${pos.size.toFixed(2)}</span>
                                </div>
                                <div class="position-metric">
                                    <span class="metric-label">Stop Loss</span>
                                    <span class="metric-value negative">$${pos.stopLoss.toFixed(2)}</span>
                                </div>
                                <div class="position-metric">
                                    <span class="metric-label">Take Profit</span>
                                    <span class="metric-value positive">$${pos.takeProfit.toFixed(2)}</span>
                                </div>
                            </div>
                            <div class="position-pnl">
                                <span class="pnl-label">Unrealized P&L</span>
                                <span class="pnl-value ${pos.pnl >= 0 ? 'positive' : 'negative'}">
                                    ${pos.pnl >= 0 ? '+' : ''}$${pos.pnl.toFixed(2)} (${pos.pnlPercent.toFixed(2)}%)
                                </span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // ============================================================================
        // TIMEFRAME SELECTOR
        // ============================================================================
        
        document.querySelectorAll('.tf-btn').forEach(btn => {
            btn.addEventListener('click', async () => {
                document.querySelectorAll('.tf-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                STATE.selectedTimeframe = btn.dataset.tf;
                
                if (STATE.currentAsset) {
                    loadAsset(STATE.currentAsset);
                }
            });
        });
        
        // ============================================================================
        // PANEL TABS
        // ============================================================================
        
        document.querySelectorAll('.panel-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const tabName = tab.dataset.tab;
                
                if (tabName === 'positions') {
                    updatePositionsPanel();
                } else if (tabName === 'journal') {
                    // TODO: Implement trade journal
                    document.getElementById('panelContent').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üìî</div>
                            <div class="empty-text">Trade journal coming soon</div>
                        </div>
                    `;
                } else if (tabName === 'alerts') {
                    // TODO: Implement alerts
                    document.getElementById('panelContent').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üîî</div>
                            <div class="empty-text">Price alerts coming soon</div>
                        </div>
                    `;
                }
            });
        });
        
        // ============================================================================
        // INITIALIZATION
        // ============================================================================
        
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Initializing APEX Terminal...');
            
            // Initialize chart
            initChart();
            
            // Load watchlist
            await loadWatchlist();
            
            // Update portfolio display
            updatePortfolioDisplay();
            
            console.log('‚úÖ APEX Terminal Ready');
            console.log('üí° Tip: This is PAPER TRADING mode. No real money at risk!');
        });
        
        // Auto-refresh prices every 30 seconds
        setInterval(async () => {
            if (STATE.currentAsset) {
                const priceData = await DataProvider.getCurrentPrice(STATE.currentAsset.symbol, STATE.currentAsset.type);
                if (priceData) {
                    STATE.currentAsset.price = priceData.price;
                    STATE.currentAsset.change24h = priceData.change24h;
                    
                    document.getElementById('currentPrice').textContent = `$${priceData.price.toFixed(priceData.price > 100 ? 2 : 6)}`;
                    
                    const changeElement = document.getElementById('currentChange');
                    changeElement.textContent = `${priceData.change24h >= 0 ? '+' : ''}${priceData.change24h.toFixed(2)}%`;
                    changeElement.className = `asset-change ${priceData.change24h >= 0 ? 'change-positive' : 'change-negative'}`;
                }
            }
        }, 30000);
    </script>
</body>
</html>
